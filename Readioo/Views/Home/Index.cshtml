@using Readioo.ViewModel
@using Readioo.Business.DataTransferObjects.Book
@model LoginVM

@{
    ViewData["Title"] = "Home Page";

    // Cast ViewBag data to safe types
    var trending = ViewBag.TrendingBooks as List<BookDto>;
    var recent = ViewBag.RecentBooks as List<BookDto>;
    var recommendations = ViewBag.Recommendations as List<BookDto>;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BookConnect – Discover, Read, Connect</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
    <link rel="stylesheet" href="~/css/globalandbook.css">
    <link rel="stylesheet" href="~/css/home.css">

    <style>
        /* Simple Card Styling Fixes just in case home.css isn't fully loaded */
        .book-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
            padding: 10px 0;
        }

        .book-card-home {
            transition: transform 0.2s;
            border: 1px solid #eee;
            border-radius: 8px;
            overflow: hidden;
            background: #fff;
        }

            .book-card-home:hover {
                transform: translateY(-5px);
                box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            }

            .book-card-home img {
                width: 100%;
                height: 250px;
                object-fit: cover;
            }

        .book-card-body {
            padding: 10px;
        }
    </style>
</head>

<body>

    <!-- ✅ Main Home Section -->
    <div class="wrap" id="home-page">

        <!-- Hero Section -->
        <section class="hero">
            <div class="hero-content">
                <h1>Welcome to <span class="highlight">Readioo</span></h1>
                <p>Discover your next great read, Search for more, and track your reading journey.</p>
                <a asp-controller="Book" asp-action="Index" class="btn btn-primary explore-btn">Explore Books</a>
            </div>
            <div class="hero-image">
                <img src="assets/images/hero-books.png" alt="Books Illustration" onerror="this.style.display='none'">
            </div>
        </section>

        <!-- Recommendations (Only if User is Logged In & Data Exists) -->
        @if (recommendations != null && recommendations.Any())
        {
            <section class="section recommendations">
                <h2 class="section-title"><i class="fa-solid fa-wand-magic-sparkles text-warning"></i> Recommended For You</h2>
                <div class="book-grid">
                    @foreach (var book in recommendations)
                    {
                        <div class="book-card-home">
                            <a asp-controller="Book" asp-action="Details" asp-route-id="@book.BookId" class="text-decoration-none text-dark">
                                <img src="@(string.IsNullOrEmpty(book.BookImage) ? "https://placehold.co/180x250?text=No+Cover" : Url.Content("~/" + book.BookImage))" alt="@book.Title">
                                <div class="book-card-body">
                                    <h6 class="text-truncate" title="@book.Title">@book.Title</h6>
                                    <small class="text-muted d-block">@book.AuthorName</small>
                                    <small class="text-warning"><i class="fa-solid fa-star"></i> @book.Rate.ToString("0.0")</small>
                                </div>
                            </a>
                        </div>
                    }
                </div>
            </section>
        }

        <!-- Trending Books -->
        <section class="section trending">
            <h2 class="section-title">📈 Trending Books</h2>
            <div class="book-grid" id="trendingBooks">
                @if (trending != null)
                {
                    foreach (var book in trending)
                    {
                        <div class="book-card-home">
                            <a asp-controller="Book" asp-action="Details" asp-route-id="@book.BookId" class="text-decoration-none text-dark">
                                <img src="@(string.IsNullOrEmpty(book.BookImage) ? "https://placehold.co/180x250?text=No+Cover" : Url.Content("~/" + book.BookImage))" alt="@book.Title">
                                <div class="book-card-body">
                                    <h6 class="text-truncate" title="@book.Title">@book.Title</h6>
                                    <small class="text-muted d-block">@book.AuthorName</small>
                                    <small class="text-warning"><i class="fa-solid fa-star"></i> @book.Rate.ToString("0.0")</small>
                                </div>
                            </a>
                        </div>
                    }
                }
            </div>
        </section>

        <!-- Recently Added -->
        <section class="section recent">
            <h2 class="section-title">🆕 Recently Added</h2>
            <div class="book-grid" id="recentBooks">
                @if (recent != null)
                {
                    foreach (var book in recent)
                    {
                        <div class="book-card-home">
                            <a asp-controller="Book" asp-action="Details" asp-route-id="@book.BookId" class="text-decoration-none text-dark">
                                <img src="@(string.IsNullOrEmpty(book.BookImage) ? "https://placehold.co/180x250?text=No+Cover" : Url.Content("~/" + book.BookImage))" alt="@book.Title">
                                <div class="book-card-body">
                                    <h6 class="text-truncate" title="@book.Title">@book.Title</h6>
                                    <small class="text-muted d-block">@book.AuthorName</small>
                                    <small class="text-muted" style="font-size: 0.8rem;"><i class="fa-regular fa-calendar"></i> @book.PublishDate.ToString("MMM yyyy")</small>
                                </div>
                            </a>
                        </div>
                    }
                }
            </div>
        </section>

        <!-- Popular Genres -->
        <section class="section genres">
            <h2 class="section-title">🎨 Popular Genres</h2>
            <div class="genre-list">
                <div class="genre-card">Classics</div>
                <div class="genre-card">Fantasy</div>
                <div class="genre-card">Romance</div>
                <div class="genre-card">Science Fiction</div>
                <div class="genre-card">Mystery</div>
                <div class="genre-card">Non-Fiction</div>
            </div>
        </section>

    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/home.js"></script>
</body>
</html>