@using Readioo.ViewModel
@using Readioo.Business.DataTransferObjects.Genre
@using Readioo.Business.DataTransferObjects.Book
@{
    ViewData["Title"] = "Home Page";

    // Cast ViewBag data to safe types
    // Removed: var trending = ViewBag.TrendingBooks as List<BookDto>;
    var recent = ViewBag.RecentBooks as List<BookDto>;
    var recommendations = ViewBag.Recommendations as List<BookDto>;

    var genreList = ViewBag.Genres as IEnumerable<GenreDto>;
    var recentBooks = ViewBag.RecentBooks as IEnumerable<BookDto>;

    string ResolveImagePath(string imagePath)
    {
        if (string.IsNullOrEmpty(imagePath)) return null;
        if (imagePath.StartsWith("http", StringComparison.OrdinalIgnoreCase)) return imagePath;
        if (imagePath.StartsWith("~") || imagePath.StartsWith("/")) return Url.Content(imagePath);
        return Url.Content("~/" + imagePath);
    }
}
@model LoginVM

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BookConnect – Discover, Read, Connect</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
    <link rel="stylesheet" href="~/css/globalandbook.css">
    <link rel="stylesheet" href="~/css/home.css">

    <style>
        .btn-custom-green {
            background-color: #146c43;
            border-color: #146c43;
            color: white;
            font-weight: 500;
        }

            .btn-custom-green:hover {
                background-color: #0f5132;
                border-color: #0a3622;
                color: white;
            }

        .book-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            background: #fff;
            transition: transform 0.2s;
            text-align: center;
            height: 100%;
        }

            .book-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            }

            .book-card img {
                width: 100%;
                height: 250px;
                object-fit: cover;
            }

        .book-card-body {
            padding: 10px;
        }

        .book-card-title {
            font-size: 1rem;
            font-weight: bold;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: #333;
        }

        .book-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
        }
    </style>
</head>

<body>

    <div class="wrap" id="home-page">

        <section class="hero">
            <div class="hero-content">
                <h1>Welcome to <span class="highlight">Readioo</span></h1>
                <p>Discover your next great read, Search for more, and Track your reading journey.</p>

                <a asp-controller="Book"
                   asp-action="Browse"
                   class="btn btn-custom-green explore-btn">
                    Explore Books
                </a>
            </div>
            <div class="hero-image">
                <img src="assets/images/hero-books.png" alt="Books Illustration" onerror="this.style.display='none'">
            </div>
        </section>

        <section class="section recent">
            <h2 class="section-title">🆕 Recently Added</h2>
            <div class="book-grid" id="recentBooks">

                @if (recent != null && recentBooks.Any())
                {
                    @foreach (var book in recentBooks)
                    {
                        var bookImgUrl = ResolveImagePath(book.BookImage);

                        <div class="book-card">
                            <a href="@Url.Action("Details", "Book", new { id = book.BookId })" style="text-decoration:none; color:inherit;">

                                <img src="@(string.IsNullOrEmpty(bookImgUrl) ? "https://placehold.co/180x250?text=No+Cover" : bookImgUrl)"
                                     alt="@book.Title"
                                     onerror="this.src='https://placehold.co/180x250?text=No+Cover'" />

                                <div class="book-card-body">
                                    <div class="book-card-title" title="@book.Title">@book.Title</div>
                                    <small class="text-muted">
                                        @if (book.Rate > 0)
                                        {
                                            <i class="fa-solid fa-star text-warning"></i>
                                            @book.Rate.ToString("0.0")
                                        }
                                        else
                                        {
                                            <span class="badge bg-success">New</span>
                                        }
                                    </small>
                                </div>
                            </a>
                        </div>
                    }
                }
                else
                {
                    <p class="text-muted">No recently added books found.</p>
                }

            </div>
        </section>

        <!-- Recommendations Section -->
        @if (recommendations != null && recommendations.Any())
        {
            <section class="section recommendations">
                <h2 class="section-title"><i class="fa-solid fa-wand-magic-sparkles text-warning"></i> Recommended For You</h2>
                <div class="book-grid">
                    @foreach (var book in recommendations)
                    {
                        var bookImgUrl = ResolveImagePath(book.BookImage);
                        <div class="book-card">
                            <a asp-controller="Book" asp-action="Details" asp-route-id="@book.BookId" class="text-decoration-none text-dark">
                                <img src="@(string.IsNullOrEmpty(bookImgUrl) ? "https://placehold.co/180x250?text=No+Cover" : bookImgUrl)"
                                     alt="@book.Title"
                                     onerror="this.src='https://placehold.co/180x250?text=No+Cover'" />
                                <div class="book-card-body">
                                    <div class="book-card-title" title="@book.Title">@book.Title</div>
                                    <small class="text-muted d-block">@book.AuthorName</small>
                                    <small class="text-warning">
                                        @if (book.Rate > 0)
                                        {
                                            <i class="fa-solid fa-star text-warning"></i>
                                            @book.Rate.ToString("0.0")
                                        }
                                        else
                                        {
                                            <span class="badge bg-success">New</span>
                                        }
                                    </small>
                                </div>
                            </a>
                        </div>
                    }
                </div>
            </section>
        }

        <section class="section genres">
            <h2 class="section-title">🎨 Popular Genres</h2>
            <div class="genre-list">
                @if (genreList != null && genreList.Any())
                {
                    @foreach (var genre in genreList)
                    {
                        <a asp-controller="Genre"
                           asp-action="Details"
                           asp-route-id="@genre.Id"
                           class="genre-card text-decoration-none text-dark">
                            @genre.GenreName
                        </a>
                    }
                }
                else
                {
                    <p class="text-muted">No genres found.</p>
                }
            </div>
        </section>

    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/home.js"></script>
</body>
</html>