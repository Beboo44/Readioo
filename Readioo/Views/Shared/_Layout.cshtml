<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Readioo</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/Readioo.styles.css" asp-append-version="true" />
</head>
<body>
    <header>
        <nav class="nav">
            <div class="empty"></div>
            <div><a asp-controller="Home" asp-action="Index"> <img src="~/images/Logo.jpg" id="logo"> </a></div>
            <div><a class="bar" asp-controller="Home" asp-action="Index">Home</a></div>
            <div><a class="bar" asp-controller="Book" asp-action="MyBooks">My Books</a></div>
            <div><a class="bar" asp-controller="Book" asp-action="Browse">Browse</a></div>
            <div><a class="bar" asp-controller="Admin" asp-action="Index">Admin Dashboard</a></div>

            <!-- SEARCH CONTAINER -->
            <div class="search-container" style="position: relative; display: inline-block;">
                <input id="bookSearch" type="text"
                       placeholder="Search Books..."
                       class="form-control"
                       autocomplete="off"
                       style="min-width: 300px;">

                <!-- DROPDOWN RESULTS -->
                <div id="searchResults" class="search-dropdown"></div>
            </div>

            <div class="profile dropdown">
                <a href="#" class="profile-toggle dropdown-toggle"
                   data-bs-toggle="dropdown"
                   aria-expanded="false">
                    <img src="/User/ProfileImage/@User.FindFirst(System.Security.Claims.ClaimTypes.NameIdentifier)?.Value"
                         style="width:40px; height:40px; border-radius:50%; object-fit:cover;"
                         onerror="this.src='/images/default-profile.png'">
                </a>
                <ul class="dropdown-menu dropdown-menu-end">
                    <li><a class="dropdown-item" asp-controller="User" asp-action="Profile">My Profile</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item text-danger" asp-controller="Account" asp-action="Logout">Logout</a></li>
                </ul>
            </div>
            <div class="empty"></div>
        </nav>
    </header>

    <div class="container" style="margin-top: 100px;">
        <main role="main" class="pb-3">
            @RenderBody()
        </main>
    </div>

    <footer class="gr-footer">
        <div class="container">
            <div class="row mb-5">
                <div class="col-md-3">
                    <h4 style="color:var(--muted)">Readioo Choice Awards 2024</h4>
                </div>
                <div class="col-md-9">
                    <div class="row">
                        <div class="col-6 col-md-3"><ul class="list-unstyled small"><li><a href="#">Readers' Favorite Fiction</a></li><li><a href="#">Readers' Favorite Romance</a></li></ul></div>
                        <div class="col-6 col-md-3"><ul class="list-unstyled small"><li><a href="#">Readers' Favorite Horror</a></li><li><a href="#">Readers' Favorite Audiobook</a></li></ul></div>
                        <div class="col-6 col-md-3"><ul class="list-unstyled small"><li><a href="#">Readers' Favorite Mystery & Thriller</a></li><li><a href="#">Readers' Favorite Science Fiction</a></li></ul></div>
                        <div class="col-6 col-md-3"><ul class="list-unstyled small"><li><a href="#">Readers' Favorite Young Adult</a></li><li><a href="#">Readers' Favorite Nonfiction</a></li></ul></div>
                    </div>
                </div>
            </div>

            <hr style="border-top: 1px solid #ddd;">

            <div class="row align-items-center">
                <div class="col-md-3">
                    <h6>COMPANY</h6><ul class="list-unstyled small"><li><a href="#">About us</a></li><li><a href="#">Careers</a></li><li><a href="#">Terms</a></li><li><a href="#">Privacy</a></li></ul>
                </div>
                <div class="col-md-3">
                    <h6>WORK WITH US</h6><ul class="list-unstyled small"><li><a href="#">Authors</a></li><li><a href="#">Advertise</a></li></ul>
                </div>
                <div class="col-md-3">
                    <h6>CONNECT</h6>
                    <div class="gr-social-icons">
                        <i class="fab fa-facebook-f me-2"></i>
                        <i class="fab fa-twitter me-2"></i>
                        <i class="fab fa-instagram me-2"></i>
                        <i class="fab fa-linkedin-in me-2"></i>
                    </div>
                </div>
                <div class="col-md-3 text-end">
                    <div class="gr-app-store-badges mb-2">
                        <p class="small text-muted mb-0">Download on App Store / Google Play</p>
                    </div>
                    <p class="small mt-2">&copy; 2025 Readioo, Inc. | Mobile version</p>
                </div>
            </div>
        </div>
    </footer>

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>

    @* <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script> *@
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    @* <script src="~/js/main.js"></script> *@
    <script src="~/js/search.js" asp-append-version="true"></script>

    <script>
        $(document).ready(function() {
            console.log("Search script loaded - debugging enabled");

            $('#bookSearch').on('input', function() {
                var query = $(this).val().trim();
                var $dropdown = $('#searchResults');

                console.log("Typing detected:", query);

                // if (query.length < 2) {
                //     console.log("Query too short, hiding dropdown");
                //     $dropdown.hide().html('');
                //     return;
                // }

                console.log("Making AJAX request for:", query);

                $.ajax({
                    url: '/Book/SearchBooks',
                    type: 'GET',
                    data: { searchTerm: query },
                    success: function(data) {
                        console.log("AJAX success, data length:", data.length);
                        console.log("Data preview:", data.substring(0, 100));
                        $dropdown.html(data).show();
                        console.log("Dropdown should be visible now");
                    },
                    error: function(xhr, status, error) {
                        console.log("AJAX error:", error);
                        $dropdown.hide().html('');
                    }
                });
            });

            // Hide dropdown when clicking outside
            $(document).on('click', function(e) {
                if (!$(e.target).closest('.search-container').length) {
                    $('#searchResults').hide();
                }
            });

            // Keep dropdown open when clicking inside results
            $('#searchResults').on('click', function(e) {
                e.stopPropagation();
            });
        });
    </script>

    @* <script type="text/javascript">
        $(function () {

            // When typing in the search box
            $("#bookSearch").on("keyup", function () {

                var inputSearch = $(this).val().trim();

                if (inputSearch !== "") {

                    $.ajax({
                        type: "POST",
                        url: "/Book/SearchBooks",
                        data: { searchTerm: inputSearch },
                        cache: false,
                        success: function (html) {
                            $("#searchResults").html(html).show();
                        },
                        error: function () {
                            $("#searchResults").hide().html("");
                        }
                    });
                } else {
                    $("#searchResults").hide().html("");
                }

                return false;
            });

            // When clicking inside the results
            $("#searchResults").on("click", ".search-item", function (e) {
                e.stopPropagation();
                var name = $(this).find('.name').text();
                $("#bookSearch").val(name);
            });

            // Hide results when clicking outside
            $(document).on("click", function (e) {
                if (!$(e.target).closest("#searchResults, #bookSearch").length) {
                    $("#searchResults").fadeOut();
                }
            });

            // Show results when clicking input
            $("#bookSearch").on("click", function () {
                $("#searchResults").fadeIn();
            });

        });
    </script> *@



    @await RenderSectionAsync("Scripts", required: false)
    @await Component.InvokeAsync("NToastNotify");

</body>
</html>